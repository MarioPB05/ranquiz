{% load static %}
{% load cloudinary %}
<!--begin::Lists View-->
<div class="card shadow mb-5 mb-xl-10">
    <!--begin::Card header-->
    <div class="card-header">
        <!--begin::Card title-->
        <div class="card-title m-0">
            {% if card_data.selected_list is None %}
                <h3 class="fw-bolder m-0">Resultados de las listas</h3>
            {% else %}
                <h3 class="fw-bolder m-0">Resultados de la lista {{ card_data.selected_list.name }}</h3>
            {% endif %}
        </div>
        <!--end::Card title-->
    </div>
    <!--begin::Card header-->

    <!--begin::Card body-->
    <div class="card-body p-9">
        {% if  card_data.selected_list is None %}
            <div class="d-flex flex-stack mb-10">
                <div class="d-flex gap-4">
                    <div class="d-flex align-items-center position-relative my-1">
                        <!--begin::Svg Icon | path: icons/duotune/general/gen021.svg-->
                        <span class="svg-icon svg-icon-1 position-absolute ms-4">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
                                <rect opacity="0.5" x="17.0365" y="15.1223" width="8.15546" height="2" rx="1"
                                      transform="rotate(45 17.0365 15.1223)" fill="currentColor"></rect>
                                <path d="M11 19C6.55556 19 3 15.4444 3 11C3 6.55556 6.55556 3 11 3C15.4444 3 19 6.55556 19 11C19 15.4444 15.4444 19 11 19ZM11 5C7.53333 5 5 7.53333 5 11C5 14.4667 7.53333 17 11 17C14.4667 17 17 14.4667 17 11C17 7.53333 14.4667 5 11 5Z"
                                      fill="currentColor"></path>
                            </svg>
                        </span>
                        <!--end::Svg Icon-->
    
                        <input id="search_input" type="text" class="form-control form-control-solid mw-250px w-100 ps-14"
                               placeholder="Buscar Listas..." value="{% if card_data.searching %}{{ card_data.search_query }}{% endif %}"
                                {% if card_data.searching %}autofocus{% endif %}
                                onfocus="this.selectionStart = this.selectionEnd = this.value.length;">
                    </div>
                
    
                    <button id="search_btn" class="btn btn-sm btn-primary my-4">
                        <span class="d-none d-sm-flex">Buscar</span>
                        <i class="bi bi-search d-flex d-sm-none fs-3"></i>
                    </button>
                </div>
                
            </div>
        {% endif %}

        {% if card_data_empty and card_data.search_query is None %}
            <!--begin::Notice-->
            <div class="notice d-flex bg-light-warning rounded border-warning border border-dashed p-6">
                <!--begin::Icon-->
                <span class="d-flex align-items-center me-4">
                    <i class="bi bi-exclamation-circle-fill text-warning fs-2tx"></i>
                </span>
                <!--end::Icon-->

                <!--begin::Wrapper-->
                <div class="d-flex flex-stack flex-grow-1">
                    <!--begin::Content-->
                    <div class="fw-bold">
                        <h4 class="text-gray-900 fw-bolder">No has jugado a ninguna lista!</h4>
                        <div class="fs-6 text-gray-700">
                            Aún no has jugado ninguna lista, prueba a explorar las listas de otros usuarios.
                        </div>
                    </div>
                    <!--end::Content-->
                </div>
                <!--end::Wrapper-->
            </div>
            <!--end::Notice-->
        {% elif card_data_empty and card_data.searching %}
            <!--begin::Notice-->
            <div class="notice d-flex bg-light-danger rounded border-danger border border-dashed p-6">
                <!--begin::Icon-->
                <span class="d-flex align-items-center me-4">
                    <i class="bi bi-exclamation-circle-fill text-danger fs-2tx"></i>
                </span>
                <!--end::Icon-->

                <!--begin::Wrapper-->
                <div class="d-flex flex-stack flex-grow-1">
                    <!--begin::Content-->
                    <div class="fw-bold">
                        <h4 class="text-gray-900 fw-bolder">¡No se han encontrado resultados!</h4>
                        <div class="fs-6 text-gray-700">
                            No se han encontrado listas con el término de búsqueda '{{ card_data.search_query }}'.
                        </div>
                    </div>
                    <!--end::Content-->
                </div>
                <!--end::Wrapper-->
            </div>
            <!--end::Notice-->
        {% else %}
            <div id="result_container" class="d-md-grid d-flex flex-column gap-10" style="grid-template-columns: repeat(auto-fill, minmax(300px, 1fr))">
                {% for result in card_data.data %}
                    <div class="d-flex justify-content-between align-items-center flex-column gap-7 border border-1 border-gray-400 rounded p-4 cursor-pointer list_result"
                        data-url="{% url 'list_result' share_code=result.share_code id_result=result.result_id %}">
                        <img class="w-100 mh-100px h-100 rounded" alt="image" style="object-fit:cover"
                            src="{% if result.list_image %}{{ result.list_image }}{% else %}{% static 'assets/media/placeholders/list_mix2.png' %}{% endif %}">

                        <div class="text-center">
                            <h1 class="fw-boldest text-primary mw-400px overflow-hidden"
                                style="text-overflow: ellipsis;">{{ result.list_name }}</h1>
                            <span class="fw-bolder text-muted">{{ result.start_date }}</span>
                        </div>

                        <div class="d-flex w-100">
                            <div class="d-flex w-100 h-100 justify-content-around">
                                <span class="d-flex justify-content-end fw-bolder text-muted min-w-60px gap-4 align-items-center">
                                    {{ result.items }}
                                    <i class="bi bi-box"></i>
                                </span>

                                <span class="d-flex justify-content-end fw-bolder text-muted min-w-60px gap-4 align-items-center">
                                    {{ result.duration }}
                                    <i class="bi bi-clock"></i>
                                </span>
                                
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>

            {% if card_data.pagination.has_other_pages %}
                <div class="text-center mt-10">
                    <ul class="pagination">
                        {% if card_data.pagination.has_previous %}
                            <li class="page-item">
                                <a class="page-link" href="{% url 'user' share_code=user_data.share_code %}?card=results&page={{ card_data.pagination.previous_page_number }}">Anterior</a>
                            </li>
                        {% endif %}

                        {% for i in card_data.pagination.page_range %}
                            <li class="page-item {% if card_data.pagination.number == i %}active{% endif %}">
                                <a class="page-link" href="{% url 'user' share_code=user_data.share_code %}?card=results&page={{ i }}">{{ i }}</a>
                            </li>
                        {% endfor %}

                        {% if card_data.pagination.has_next %}
                            <li class="page-item">
                                <a class="page-link" href="{% url 'user' share_code=user_data.share_code %}?card=results&page={{ card_data.pagination.next_page_number }}">Siguiente</a>
                            </li>
                        {% endif %}
                    </ul>
                </div>
            {% endif %}
        {% endif %}
    </div>
    <!--end::Card body-->
</div>
<!--end::Lists View-->

<script>const baseURL = '{{ request.scheme }}://{{ request.get_host }}{{ current_path|safe }}';</script>
<script src="{% static 'scripts/pages/profile/results.js' %}" type="module" defer></script>